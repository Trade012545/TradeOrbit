<!DOCTYPE html>
<html lang="en" class="dark">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Trade Page</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      darkMode: 'class'
    };
  </script>
  <script src="https://unpkg.com/lightweight-charts/dist/lightweight-charts.standalone.production.js"></script>
  <script src="https://s3.tradingview.com/tv.js"></script>
</head>
<body class="bg-gray-900 text-white">
  <div id="app" class="grid grid-cols-4 grid-rows-1 min-h-screen gap-2 p-4">
    <!-- TradingView Chart -->
    <div class="col-span-3 bg-gray-800 rounded-2xl shadow p-2">
      <div id="tv_chart_container" class="h-[500px] w-full"></div>
    </div>

    <!-- Buy/Sell & Order Book -->
    <div class="col-span-1 flex flex-col gap-4">
      <!-- Buy/Sell Form -->
      <div class="bg-gray-800 p-4 rounded-2xl shadow">
        <h2 class="text-xl font-bold mb-2">Place Order</h2>
        <form id="orderForm" class="space-y-2">
          <input type="number" id="price" placeholder="Price" class="w-full p-2 rounded bg-gray-700 text-white" required />
          <input type="number" id="quantity" placeholder="Quantity" class="w-full p-2 rounded bg-gray-700 text-white" required />
          <div class="flex justify-between gap-2">
            <button type="button" onclick="placeOrder('buy')" class="w-1/2 bg-green-600 hover:bg-green-700 p-2 rounded text-white font-semibold">Buy</button>
            <button type="button" onclick="placeOrder('sell')" class="w-1/2 bg-red-600 hover:bg-red-700 p-2 rounded text-white font-semibold">Sell</button>
          </div>
        </form>
      </div>

      <!-- Order Book -->
      <div class="bg-gray-800 p-4 rounded-2xl shadow flex-1 overflow-y-auto">
        <h2 class="text-xl font-bold mb-2">Order Book</h2>
        <div id="orderBook" class="text-sm space-y-1">
          <!-- Orders will be listed here -->
        </div>
      </div>
    </div>
  </div>

  <script>
    // Initialize TradingView Widget
    new TradingView.widget({
      container_id: "tv_chart_container",
      autosize: true,
      symbol: "BINANCE:BTCUSDT",
      interval: "15",
      timezone: "Etc/UTC",
      theme: "dark",
      style: "1",
      locale: "en",
      toolbar_bg: "#1f2937",
      enable_publishing: false,
      hide_top_toolbar: false,
      withdateranges: true,
      hide_side_toolbar: false,
      allow_symbol_change: true,
      details: true,
      studies: [
        "MACD@tv-basicstudies"
      ]
    });

    const orderBook = document.getElementById("orderBook");

    function placeOrder(type) {
      const price = parseFloat(document.getElementById("price").value);
      const quantity = parseFloat(document.getElementById("quantity").value);

      if (!price || !quantity) {
        alert("Please enter both price and quantity.");
        return;
      }

      const order = {
        type,
        price,
        quantity,
        timestamp: new Date().toLocaleTimeString()
      };

      // Normally you'd push to Appwrite here. For now, add to DOM.
      const orderItem = document.createElement("div");
      orderItem.className = `flex justify-between ${type === 'buy' ? 'text-green-400' : 'text-red-400'}`;
      orderItem.textContent = `${type.toUpperCase()} @ $${order.price} x ${order.quantity} (${order.timestamp})`;
      orderBook.prepend(orderItem);

      // Reset form
      document.getElementById("orderForm").reset();
    }
  </script>
</body>
</html>
